<?php
namespace CroudTech\RecurringTaskScheduler\Tests\ScheduleParser;

use Carbon\Carbon;
use CroudTech\RecurringTaskScheduler\Library\ScheduleParser\Periodic as PeriodicParser;
use CroudTech\RecurringTaskScheduler\Tests\TestCase;

/**
 * Check scheduler periods:
 *
 * Daily
 *  - Every N days {period, interval}
 *  - Every Workday {period, interval, modifier}
 *  - Every DOW {period, interval}
 *
 */
class DefinitionsTestDaily extends TestCase
{
    /**
     * @dataProvider definitionsProvider
     */
    public function testDefinitions($definition, $expected)
    {
        $parser = $this->app->make(\CroudTech\RecurringTaskScheduler\Library\ScheduleParser\Factory::class)->factory($definition);
        $generated_dates = collect($parser->getDates());
        $this->assertEquals($expected, $generated_dates->map(
            function ($date) {
                return $date->format('c');
            }
        )->toArray());
    }

    public function definitionsProvider()
    {
        // $date = new Carbon('2017-01-01 00:00:00');
        // while ($date->lte(new Carbon('2017-01-31 00:00:00'))) {
        //     echo '\'' . $date->format('c') . '\','.PHP_EOL;
        //     $date->addDay(1);
        // }
        // die();

        return [
            // Every DOW
            [
                [
                    'type' => 'periodic',
                    'range' => [
                        '2017-01-01 00:00:00',
                        '2017-01-31 23:59:59',
                    ],
                    'period' => 'days',
                    'interval' => 1
                ],
                [
                    '2017-01-01T09:00:00+00:00',
                    '2017-01-02T09:00:00+00:00',
                    '2017-01-03T09:00:00+00:00',
                    '2017-01-04T09:00:00+00:00',
                    '2017-01-05T09:00:00+00:00',
                    '2017-01-06T09:00:00+00:00',
                    '2017-01-07T09:00:00+00:00',
                    '2017-01-08T09:00:00+00:00',
                    '2017-01-09T09:00:00+00:00',
                    '2017-01-10T09:00:00+00:00',
                    '2017-01-11T09:00:00+00:00',
                    '2017-01-12T09:00:00+00:00',
                    '2017-01-13T09:00:00+00:00',
                    '2017-01-14T09:00:00+00:00',
                    '2017-01-15T09:00:00+00:00',
                    '2017-01-16T09:00:00+00:00',
                    '2017-01-17T09:00:00+00:00',
                    '2017-01-18T09:00:00+00:00',
                    '2017-01-19T09:00:00+00:00',
                    '2017-01-20T09:00:00+00:00',
                    '2017-01-21T09:00:00+00:00',
                    '2017-01-22T09:00:00+00:00',
                    '2017-01-23T09:00:00+00:00',
                    '2017-01-24T09:00:00+00:00',
                    '2017-01-25T09:00:00+00:00',
                    '2017-01-26T09:00:00+00:00',
                    '2017-01-27T09:00:00+00:00',
                    '2017-01-28T09:00:00+00:00',
                    '2017-01-29T09:00:00+00:00',
                    '2017-01-30T09:00:00+00:00',
                    '2017-01-31T09:00:00+00:00',
                ],
            ],
            // Every Workday
            [
                [
                    'type' => 'periodic',
                    'range' => [
                        '2017-01-01 00:00:00',
                        '2017-01-31 23:59:59',
                    ],
                    'period' => 'days',
                    'interval' => 1,
                    'days' => [
                        'mon' => true,
                        'tue' => true,
                        'wed' => true,
                        'thu' => true,
                        'fri' => true,
                    ],
                ],
                [
                    //'2017-01-01T09:00:00+00:00',
                    '2017-01-02T09:00:00+00:00',
                    '2017-01-03T09:00:00+00:00',
                    '2017-01-04T09:00:00+00:00',
                    '2017-01-05T09:00:00+00:00',
                    '2017-01-06T09:00:00+00:00',
                    // '2017-01-07T09:00:00+00:00',
                    // '2017-01-08T09:00:00+00:00',
                    '2017-01-09T09:00:00+00:00',
                    '2017-01-10T09:00:00+00:00',
                    '2017-01-11T09:00:00+00:00',
                    '2017-01-12T09:00:00+00:00',
                    '2017-01-13T09:00:00+00:00',
                    // '2017-01-14T09:00:00+00:00',
                    // '2017-01-15T09:00:00+00:00',
                    '2017-01-16T09:00:00+00:00',
                    '2017-01-17T09:00:00+00:00',
                    '2017-01-18T09:00:00+00:00',
                    '2017-01-19T09:00:00+00:00',
                    '2017-01-20T09:00:00+00:00',
                    // '2017-01-21T09:00:00+00:00',
                    // '2017-01-22T09:00:00+00:00',
                    '2017-01-23T09:00:00+00:00',
                    '2017-01-24T09:00:00+00:00',
                    '2017-01-25T09:00:00+00:00',
                    '2017-01-26T09:00:00+00:00',
                    '2017-01-27T09:00:00+00:00',
                    // '2017-01-28T09:00:00+00:00',
                    // '2017-01-29T09:00:00+00:00',
                    '2017-01-30T09:00:00+00:00',
                    '2017-01-31T09:00:00+00:00',
                ],
            ],
            // Every N Days
            [
                [
                    'type' => 'periodic',
                    'range' => [
                        '2017-01-01 00:00:00',
                        '2017-01-31 23:59:59',
                    ],
                    'period' => 'days',
                    'interval' => 3
                ],
                [
                    '2017-01-01T09:00:00+00:00',
                    // '2017-01-02T09:00:00+00:00',
                    // '2017-01-03T09:00:00+00:00',
                    '2017-01-04T09:00:00+00:00',
                    // '2017-01-05T09:00:00+00:00',
                    // '2017-01-06T09:00:00+00:00',
                    '2017-01-07T09:00:00+00:00',
                    // '2017-01-08T09:00:00+00:00',
                    // '2017-01-09T09:00:00+00:00',
                    '2017-01-10T09:00:00+00:00',
                    // '2017-01-11T09:00:00+00:00',
                    // '2017-01-12T09:00:00+00:00',
                    '2017-01-13T09:00:00+00:00',
                    // '2017-01-14T09:00:00+00:00',
                    // '2017-01-15T09:00:00+00:00',
                    '2017-01-16T09:00:00+00:00',
                    // '2017-01-17T09:00:00+00:00',
                    // '2017-01-18T09:00:00+00:00',
                    '2017-01-19T09:00:00+00:00',
                    // '2017-01-20T09:00:00+00:00',
                    // '2017-01-21T09:00:00+00:00',
                    '2017-01-22T09:00:00+00:00',
                    // '2017-01-23T09:00:00+00:00',
                    // '2017-01-24T09:00:00+00:00',
                    '2017-01-25T09:00:00+00:00',
                    // '2017-01-26T09:00:00+00:00',
                    // '2017-01-27T09:00:00+00:00',
                    '2017-01-28T09:00:00+00:00',
                    // '2017-01-29T09:00:00+00:00',
                    // '2017-01-30T09:00:00+00:00',
                    '2017-01-31T09:00:00+00:00',
                ],
            ],
        ];
    }
}
